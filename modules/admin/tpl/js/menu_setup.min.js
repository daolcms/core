jQuery(function(e){function s(t){var n;moduleList=t.menuList;if(moduleList){var r=e("#menuNameList");for(var i in moduleList){var s=moduleList[i];n=e('<optgroup label="'+i+'" />').appendTo(r);for(var o in s){n.append('<option value="'+i+":"+o+'">'+s[o].title+"</option>")}}}}var t;var n;var r=e("#editForm");var i=e("#listForm");e("a._add").click(function(){n=e(this).parent().prevAll("._item_key").val();r.find("input[name=parent_srl]").val(n);if(!t){var i=new Array;var o=new Array("menuList");exec_xml("menu","procMenuAdminAllActList",i,s,o)}});e("a._parent_delete").click(function(){var t=e(this).parent().prevAll("._parent_key").val();i.find("input[name=menu_item_srl]").val(t);i.submit()});e("a._child_delete").click(function(){var t=e(this).closest("li").find("._item_key").val();i.find("input[name=menu_item_srl]").val(t);i.submit()})});jQuery(function(e){function r(e,t){var n=0,r=0;while(e&&e!=t){n+=e.offsetTop;r+=e.offsetLeft;e=e.offsetParent}return{top:n,left:r}}e("form.siteMap").delegate("li:not(.placeholder)","dropped.st",function(){var t=e(this),n,r,i;n=t.find(">input._parent_key");i=!!t.parent("ul").parent("li").length;if(i){n.val(t.parent("ul").parent("li").find(">input._item_key").val())}else{n.val("0")}});var t=false,n=e('<li class="placeholder">');e("div.adminMenu").delegate("li:not(.placeholder,.parent)",{"mousedown.st":function(i){var s,o,u,a,f,l,c,h,p,d,v="";if(e(i.target).is("a,input,label,textarea")||i.which!=1)return;t=true;s=e(this);f=s.height();a=s.width();o=s.parentsUntil(".siteMap").filter("ul");u=o.eq(-1);u.css("position","relative");c={x:i.pageX,y:i.pageY};l=r(this,u.get(0));$clone=s.clone(true).attr("target",true);for(p=o.length-1;p;p--){$clone=$clone.wrap("<li><ul /></li>").parent().parent()}h=[];u.find("li").each(function(t){if(s[0]===this||s.has(this).length)return true;var n=r(this,u.get(0));h.push({top:n.top,bottom:n.top+32,$item:e(this)})});$clone.find(".side,input").remove().end().addClass("draggable").css({position:"absolute",opacity:.6,width:a,height:f,left:l.left,top:l.top,zIndex:100}).appendTo(u.eq(0));n.css({position:"absolute",opacity:.6,width:a,height:"10px",left:l.left,top:l.top,zIndex:99}).appendTo(u.eq(0));s.css("opacity",.6);e(document).unbind("mousemove.st mouseup.st").bind("mousemove.st",function(e){var t,r,i,s,o,u;d=null;t={x:c.x-e.pageX,y:c.y-e.pageY};r=l.top-t.y;for(s=0,o=h.length;s<o;s++){u=h[s];if(u.top>r||u.bottom<r)continue;d={element:u.$item};if(u.$item.hasClass("parent")){d.state="prepend";n.css("top",u.bottom-5)}else if(u.top>r-12){d.state="before";n.css("top",u.top-5)}else{d.state="after";n.css("top",u.bottom-5)}}$clone.css({top:r})}).bind("mouseup.st",function(r){var i,o;t=false;e(document).unbind("mousemove.st mouseup.st");s.css("opacity","");$clone.remove();n.remove();o=e("<li />").height(s.height());if(!d)return;i=e(d.element);s.before(o);if(d.state=="prepend"){if(!i.find(">ul").length)i.find(">.side").after("<ul>");i.find(">ul").prepend(s.hide())}else{i[d.state](s.hide())}s.slideDown(100,function(){s.removeClass("active")});o.slideUp(100,function(){var e=o.parent();o.remove();if(!e.children("li").length)e.remove()});s.trigger("dropped.st")});return false},"mouseover.st":function(){if(!t)e(this).addClass("active");return false},"mouseout.st":function(){if(!t)e(this).removeClass("active");return false}}).find("li").prepend('<button type="button" class="moveTo">Move to</button>').filter(".parent").find(">button.moveTo").css({visibility:"hidden","margin-left":"-12px"}).end().end().end();e('<div id="dropzone-marker" />').css({display:"none",position:"absolute",backgroundColor:"#000",opacity:.7}).appendTo("body")})