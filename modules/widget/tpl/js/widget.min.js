function getStyle(a){var b=a.getAttribute("style");return b||(b=a.style),"object"==typeof b&&(b=b.cssText),b=b.replace(/\burl\s*\(\s*"(.*?)"\s*\)/i,"url('$1')")}function getFloat(a){return jQuery(a).css("float")}function setFloat(a,b){jQuery(a).css("float",b)}function getPadding(a,b){var c=a.getAttribute("widget_padding_"+b);return c&&null!=c||(c=0),c}function doStartPageModify(a,b){zonePageObj=get_by_id(a),zoneModuleSrl=b,jQuery("#tmpPageSizeLayer").attr("id","pageSizeLayer").css({position:"absolute",left:0,top:0}).hide().appendTo("body").find(">form").submit(function(){return doApplyWidgetSize(this),!1}),doFitBorderSize(),xAddEventListener(document.getElementById("zonePageContent"),"click",doCheckWidget),xAddEventListener(document.getElementById("zonePageContent"),"mousedown",doCheckWidgetDrag),xAddEventListener(document.getElementById("zonePageContent"),"mouseover",widgetSetup)}function removeAllWidget(){confirm(confirm_delete_msg)&&(restoreWidgetButtons(),jQuery(zonePageObj).html(""))}function getWidgetContent(a){var b="";void 0!==a&&a||(a=zonePageObj);var c=null;return jQuery("div.widgetOutput",a).each(function(){if(jQuery(this).parent().get(0)==a)switch(c=jQuery(this).attr("widget")){case"widgetBox":b+=getWidgetBoxCode(this,c);break;case"widgetContent":b+=getContentWidgetCode(this,c);break;default:b+=getWidgetCode(this,c)}}),b}function getContentWidgetCode(a,b){var c,d=(a.firstChild,jQuery("div.widgetContent",a)),e="",f="",g=0,h="contenteditable,id,style,src,widget,body,class,widget_width,widget_width_type,xdpx,xdpy,height,document_srl,widget_padding_left,widget_padding_right,widget_padding_top,widget_padding_bottom,hascontent";if(d.size()>0){g=jQuery(a).attr("document_srl"),e=g>0?"":d.html();for(var i,j=new RegExp("^("+h.replace(/,/g,"|")+")$","i"),k=0;k<a.attributes.length;k++)(c=a.attributes[k].nodeName)&&a.attributes[k].nodeValue&&(j.test(c)||(i=a.attributes[k].nodeValue)&&(f+=c+'="'+encodeURIComponent(i)+'" '));return'<img hasContent="true" class="zbxe_widget_output" widget="widgetContent" style="'+getStyle(a)+'" body="'+e+'" document_srl="'+g+'" widget_padding_left="'+getPadding(a,"left")+'" widget_padding_right="'+getPadding(a,"right")+'" widget_padding_top="'+getPadding(a,"top")+'" widget_padding_bottom="'+getPadding(a,"bottom")+'" '+f+" />"}return""}function getWidgetBoxCode(a,b){for(var c="",d=0;d<a.attributes.length;d++)if(a.attributes[d].nodeName&&a.attributes[d].nodeValue&&!/^jquery[0-9]+/i.test(a.attributes[d].nodeName)){var e=a.attributes[d].nodeName.toLowerCase();if("widget_padding_left"!=e&&"widget_padding_right"!=e&&"widget_padding_top"!=e&&"widget_padding_bottom"!=e&&"contenteditable"!=e&&"id"!=e&&"style"!=e&&"src"!=e&&"widget"!=e&&"body"!=e&&"class"!=e&&"widget_width"!=e&&"widget_width_type"!=e&&"xdpx"!=e&&"xdpy"!=e&&"height"!=e){var f=a.attributes[d].nodeValue;f&&"Array"!=f&&(c+=e+'="'+encodeURIComponent(f)+'" ')}}var g;jQuery(".widget_inner",a).size()>0?(g=jQuery(".widget_inner",a),g=g.get(0)):g=jQuery(".nullWidget",a).get(0);var h=getWidgetContent(g);return'<div widget="widgetBox" style="'+getStyle(a)+'" widget_padding_left="'+getPadding(a,"left")+'" widget_padding_right="'+getPadding(a,"right")+'" widget_padding_top="'+getPadding(a,"top")+'" widget_padding_bottom="'+getPadding(a,"bottom")+'" '+c+"><div><div>"+h+"</div></div></div>"}function getWidgetCode(a,b){for(var c="",d=0;d<a.attributes.length;d++)if(a.attributes[d].nodeName&&a.attributes[d].nodeValue&&!/^jquery[0-9]+/i.test(a.attributes[d].nodeName)){var e=a.attributes[d].nodeName.toLowerCase();if("contenteditable"!=e&&"id"!=e&&"style"!=e&&"src"!=e&&"widget"!=e&&"body"!=e&&"class"!=e&&"widget_width"!=e&&"widget_width_type"!=e&&"xdpx"!=e&&"xdpy"!=e&&"height"!=e){var f=a.attributes[d].nodeValue;f&&"Array"!=f&&"null"!=f&&(c+=e+'="'+encodeURIComponent(f)+'" ')}}a.getAttribute("style");return'<img class="zbxe_widget_output" style="'+getStyle(a)+'" widget="'+b+'" '+c+" />"}function doAddContent(a){var b=request_uri.setQuery("module","widget").setQuery("act","dispWidgetAdminAddContent").setQuery("module_srl",zoneModuleSrl).setQuery("mid",a);popopen(b,"addContent")}function doSyncPageContent(){if(opener&&opener.selectedWidget){var a=get_by_id("content_fo"),b=opener.selectedWidget;a.style.value=getStyle(opener.selectedWidget),a.widget_padding_left.value=getPadding(b,"left"),a.widget_padding_right.value=getPadding(b,"right"),a.widget_padding_bottom.value=getPadding(b,"bottom"),a.widget_padding_top.value=getPadding(b,"top");for(var c=b.firstChild;c&&"widgetContent"!=c.className;)c=c.nextSibling;if(c&&"widgetContent"==c.className&&(!a.document_srl||0==a.document_srl.value))try{var d=Base64.decode(xInnerHtml(c));d=editorReplacePath(d),get_by_id("content_fo").content.value=d,xe.Editors[1].exec("SET_IR",[d])}catch(a){}}"undefined"!=typeof editorStart&&editorStart(1,"module_srl","content",!1,400)}function addContentWidget(a){var b=a.getAttribute("editor_sequence"),c=(a.mid.value,a.module_srl.value),d=a.document_srl.value,e=editorGetContent(b),f={editor_sequence:b,content:e,module_srl:c,document_srl:d};if(/^\s*<p>.*<\/p>\s*$/i.test(f.content)){var g=f.content.toLowerCase(),h=g.indexOf("</p>"),i=g.lastIndexOf("</p>");h>0&&i>0&&h==i&&(f.content=e=f.content.replace(/^\s*<p>|<\/p>\s*$/gi,""))}return exec_xml("widget","procWidgetInsertDocument",f,function(b,c){if(b&&"0"==b.error){var d=b.document_srl,f=opener.jQuery("div.widgetOutput[widget=widgetContent][document_srl="+d+"]"),g=[];f.size()>0&&(g=f.get(0).attributes);for(var h='<div class="widgetOutput" style="'+a.style.value+'" widget_padding_left="'+a.widget_padding_left.value+'" widget_padding_right="'+a.widget_padding_right.value+'" widget_padding_top="'+a.widget_padding_top.value+'" widget_padding_bottom="'+a.widget_padding_bottom.value+'" document_srl="'+d+'" widget="widgetContent"><button type="button" class="widgetResize"></button><button type="button" class="widgetResizeLeft"></button><div class="widgetBorder"><div style="padding:'+a.widget_padding_top.value+"px "+a.widget_padding_right.value+"px"+a.widget_padding_bottom.value+"px"+a.widget_padding_left.value+'px"></div>'+e+'</div><div class="widgetContent" style="display:none;width:1px;height:1px;overflow:hidden;"></div></div>',i=jQuery(h),j=0,k=g.length;j<k;j++)i.attr(g[j].name)||i.attr(g[j].name,g[j].value);h=jQuery("<div>").append(i).html(),opener.doAddWidgetCode(h),window.close()}},"document_srl".split(",")),!1}function doAddWidgetBox(){zonePageObj.innerHTML+='<div class="widgetOutput" style="float:left;width:100%;height:20px;" widget="widgetBox" ><button type="button" class="widgetBoxResize"></button><button type="button" class="widgetBoxResizeLeft"></button><div class="widgetBoxBorder"><div class="nullWidget" style="width:100%;height:100px;"></div></div></div>',doFitBorderSize()}function doAddWidget(a){var b=a.widget_list,c=b.selectedIndex,d=b.options[c].value,e=a.module_srl.value,f=request_uri.setQuery("module","widget").setQuery("act","dispWidgetGenerateCodeInPage").setQuery("selected_widget",d).setQuery("module_srl",e);popopen(f,"GenerateWidgetCode")}function doFitBorderSize(){for(var a=jQuery(".widgetBorer",zonePageObj).get(),b=0;b<a.length;b++){var c=a[b],d=xHeight(c.parentNode);d<3&&(d=20),xHeight(c,d),c.parentNode.style.clear=""}for(var a=jQuery(".widgetBoxBorder",zonePageObj).get(),b=0;b<a.length;b++){var c=a[b];xHeight(c,xHeight(c.parentNode)),c.parentNode.style.clear=""}}function doAddWidgetCode(widget_code){restoreWidgetButtons();for(var tmp=widget_code;tmp.indexOf("\x3c!--#Meta:")>-1;){var pos=tmp.indexOf("\x3c!--#Meta:");tmp=tmp.substr(pos);var eos=tmp.indexOf("--\x3e"),cssfile=tmp.substr(10,eos-10);if(cssfile.indexOf(".js")>-1)tmp=tmp.substr(eos);else{if(!cssfile)break;if(tmp=tmp.substr(eos),cssfile=request_uri+cssfile,void 0===document.createStyleSheet){var css='<link rel="stylesheet" href="'+cssfile+'" type="text/css" charset="UTF-8" />',dummy=xCreateElement("DIV");xInnerHtml(dummy,css),document.body.appendChild(dummy)}else document.createStyleSheet(cssfile,0)}}for(checkDocumentWrite=!0,tmp=widget_code.toLowerCase();tmp.indexOf("<script")>-1;){var pos=tmp.indexOf("<script");tmp=tmp.substr(pos);var length=tmp.indexOf("<\/script>")+9,script=widget_code.substr(pos,length);script=script.replace(/^<script([^>]*)>/i,"").replace(/<\/script>$/i,""),writedText=null;try{eval(script)}catch(a){}widget_code=widget_code.substr(0,pos)+writedText+widget_code.substr(pos+length),tmp=widget_code.toLowerCase()}var dummy=xCreateElement("div");xInnerHtml(dummy,widget_code);var obj=dummy.childNodes[0];if(selectedWidget&&selectedWidget.getAttribute("widget")){var o=jQuery("div.widget_inner",selectedWidget),n=jQuery("div.widget_inner",obj);0==n.size()&&(n=jQuery("div.nullWidget",obj)),0==o.size()&&(o=jQuery("div.nullWidget",selectedWidget)),n.html(o.html()),selectedWidget.parentNode.insertBefore(obj,selectedWidget),selectedWidget.parentNode.removeChild(selectedWidget)}else get_by_id("zonePageContent").appendChild(obj);checkDocumentWrite=!1,selectedWidget=null}function doCheckWidget(a){var b=new xEvent(a);if(b.target){var c=b.target;selectedWidget=null;for(var d=c.parentNode;d;){if("pageSizeLayer"==d.id)return;d=d.parentNode}if(doHideWidgetSizeSetup(),"widgetSetup"==c.className){var e=c.parentNode.parentNode,f=e.getAttribute("widget");if(!f)return;return selectedWidget=e,void("widgetContent"==f?popopen(request_uri+"?module=widget&act=dispWidgetAdminAddContent&module_srl="+zoneModuleSrl+"&document_srl="+e.getAttribute("document_srl"),"addContent"):popopen(request_uri+"?module=widget&act=dispWidgetGenerateCodeInPage&selected_widget="+f+"&widgetstyle="+g,"GenerateCodeInPage"))}if("widgetStyle"==c.className){var e=c.parentNode.parentNode,f=e.getAttribute("widget"),g=e.getAttribute("widgetstyle");if(!f)return;return selectedWidget=e,void popopen(request_uri+"?module=widget&act=dispWidgetStyleGenerateCodeInPage&selected_widget="+f+"&widgetstyle="+g,"GenerateCodeInPage")}if("widgetCopy"==c.className&&"widgetOutput"==c.parentNode.parentNode.className){var e=c.parentNode.parentNode;if(restoreWidgetButtons(),"widgetContent"==e.getAttribute("widget")&&e.getAttribute("document_srl")){var h=new Array("error","message","document_srl"),i=[];return i.document_srl=e.getAttribute("document_srl"),void exec_xml("widget","procWidgetCopyDocument",i,completeCopyWidgetContent,h,i,e)}var j=xCreateElement("DIV");xInnerHtml(j,xInnerHtml(e)),j.widget_sequence="",j.className="widgetOutput";for(var k=0;k<e.attributes.length;k++)if(e.attributes[k].nodeName&&e.attributes[k].nodeValue){var l=e.attributes[k].nodeName.toLowerCase(),m=e.attributes[k].nodeValue;m&&(m&&"string"==typeof m&&(m=m.replace(/\"/gi,"&quot;")),j.setAttribute(l,m))}return xIE4Up&&(j.style.cssText=e.style.cssText),void e.parentNode.insertBefore(j,e)}if("widgetSize"==c.className||"widgetBoxSize"==c.className){var e=c.parentNode.parentNode,f=e.getAttribute("widget");if(!f)return;return selectedWidget=e,void doShowWidgetSizeSetup(b.pageX,b.pageY,selectedWidget)}if("widgetRemove"==c.className||"widgetBoxRemove"==c.className){var e=c.parentNode.parentNode,f=e.getAttribute("widget");return void(confirm(confirm_delete_msg)&&(restoreWidgetButtons(),e.parentNode.removeChild(e)))}for(var e=c;e;){if("widgetOutput"==e.className){b.cancelBubble=!0,b.returnValue=!1,xPreventDefault(a),xStopPropagation(a);break}e=e.parentNode}}}function completeCopyWidgetContent(a,b,c,d){var e=a.document_srl,f=xCreateElement("DIV");xInnerHtml(f,xInnerHtml(d)),f.widget_sequence="",f.className="widgetOutput";for(var g=0;g<d.attributes.length;g++)if(d.attributes[g].nodeName&&d.attributes[g].nodeValue){var h=d.attributes[g].nodeName.toLowerCase(),i=d.attributes[g].nodeValue;i&&(i&&"string"==typeof i&&(i=i.replace(/\"/gi,"&quot;")),f.setAttribute(h,i))}d.setAttribute("document_srl",e),xIE4Up&&(f.style.cssText=d.getAttribute("style").cssText),d.parentNode.insertBefore(f,d)}function completeDeleteWidgetContent(a,b,c,d){restoreWidgetButtons(),d.parentNode.removeChild(d)}function doCheckWidgetDrag(a){var b=new xEvent(a);if(b.target){var c=b.target;if(!(jQuery(c).parents("#pageSizeLayer").size()>0)&&(doHideWidgetSizeSetup(),"widgetSetup"!=c.className&&"widgetStyle"!=c.className&&"widgetCopy"!=c.className&&"widgetBoxCopy"!=c.className&&"widgetSize"!=c.className&&"widgetBoxSize"!=c.className&&"widgetRemove"!=c.className&&"widgetBoxRemove"!=c.className))for(p_obj=c;p_obj;){if("widgetOutput"==p_obj.className||"widgetResize"==p_obj.className||"widgetResizeLeft"==p_obj.className||"widgetBoxResize"==p_obj.className||"widgetBoxResizeLeft"==p_obj.className)return widgetDragEnable(p_obj,widgetDragStart,widgetDrag,widgetDragEnd),void widgetMouseDown(a);p_obj=p_obj.parentNode}}}function _getInt(a){return a&&"null"!=a?isNaN(parseInt(a,10))?0:parseInt(a,10):0}function doShowWidgetSizeSetup(a,b,c){var d=jQuery("#pageSizeLayer"),e=d.find(">form:first"),c=jQuery(c);if(e.length){selectedSizeWidget=c[0];var f={widget_align:c.css("float"),width:c[0].style.width,height:c[0].style.height,padding_left:_getInt(c.attr("widget_padding_left")),padding_right:_getInt(c.attr("widget_padding_right")),padding_top:_getInt(c.attr("widget_padding_top")),padding_bottom:_getInt(c.attr("widget_padding_bottom")),margin_left:_getInt(c[0].style.marginLeft),margin_right:_getInt(c[0].style.marginRight),margin_top:_getInt(c[0].style.marginTop),margin_bottom:_getInt(c[0].style.marginBottom),border_top_color:transRGB2Hex(c[0].style.borderTopColor),border_top_thick:c[0].style.borderTopWidth.replace(/px$/i,""),border_top_type:c[0].style.borderTopStyle,border_bottom_color:transRGB2Hex(c[0].style.borderBottomColor),border_bottom_thick:c[0].style.borderBottomWidth.replace(/px$/i,""),border_bottom_type:c[0].style.borderBottomStyle,border_right_color:transRGB2Hex(c[0].style.borderRightColor),border_right_thick:c[0].style.borderRightWidth.replace(/px$/i,""),border_right_type:c[0].style.borderRightStyle,border_left_color:transRGB2Hex(c[0].style.borderLeftColor),border_left_thick:c[0].style.borderLeftWidth.replace(/px$/i,""),border_left_type:c[0].style.borderLeftStyle,background_color:transRGB2Hex(c[0].style.backgroundColor),background_image_url:c[0].style.backgroundImage.replace(/^url\(/i,"").replace(/\)$/i,""),background_x:0,background_y:0,background_repeat:c[0].style.backgroundRepeat},g=c[0].style.backgroundPosition;g&&(g=g.split(" "),2==g.length&&(f.background_x=g[0],f.background_y=g[1])),d.css("top",b+"px").show();var h=jQuery(zonePageObj),i=h.offset().left,j=h.width();a+d.width()>i+j&&(a=i+j-d.width()-5),d.css("left",a+"px"),jQuery.each(f,function(a,b){var c=e[0].elements[a];c&&(c.value=b),"select"==c.tagName.toLowerCase()&&-1==c.selectedIndex&&(c.selectedIndex=0)});try{e[0].elements[0].focus()}catch(a){}}}function doHideWidgetSizeSetup(){jQuery("#pageSizeLayer").hide()}function _getSize(a){if(!a)return 0;var b="px";a.lastIndexOf("%")>=0&&(b="%");var c=parseInt(a,10);return c<1?0:("%"==b&&c>100&&(c=100),""+c+b)}function _getBorderStyle(a,b,c){var d=a.value;d=d.replace(/^#/,""),d=d?"#"+d:"#FFFFFF";var e=b.value;e=e?parseInt(e,10)+"px":"0px";var f=c.options[c.selectedIndex].value;return f||(f="solid"),d+" "+e+" "+f}function _getBGColorStyle(a){var b=a.replace(/^#/,"");return b=b?"#"+b:"#FFFFFF"}function doApplyWidgetSize(a){if(selectedSizeWidget){1==a.widget_align.selectedIndex?setFloat(selectedSizeWidget,"right"):setFloat(selectedSizeWidget,"left");var b=_getSize(a.width.value);b&&(selectedSizeWidget.style.width=b);var c=_getSize(a.height.value);if(c&&"100%"!=c)selectedSizeWidget.style.height=c;else{selectedSizeWidget.style.height="";for(var d=xGetElementsByClassName("widgetBorder",selectedSizeWidget),e=0;e<d.length;e++){d[e].style.height=""}}selectedSizeWidget.style.borderTop=_getBorderStyle(a.border_top_color,a.border_top_thick,a.border_top_type),selectedSizeWidget.style.borderBottom=_getBorderStyle(a.border_bottom_color,a.border_bottom_thick,a.border_bottom_type),selectedSizeWidget.style.borderLeft=_getBorderStyle(a.border_left_color,a.border_left_thick,a.border_left_type),selectedSizeWidget.style.borderRight=_getBorderStyle(a.border_right_color,a.border_right_thick,a.border_right_type),selectedSizeWidget.style.marginTop=_getSize(a.margin_top.value),selectedSizeWidget.style.marginRight=_getSize(a.margin_right.value),selectedSizeWidget.style.marginBottom=_getSize(a.margin_bottom.value),selectedSizeWidget.style.marginLeft=_getSize(a.margin_left.value),a.background_color.value&&"transparent"!=a.background_color.value?selectedSizeWidget.style.backgroundColor=_getBGColorStyle(a.background_color.value):selectedSizeWidget.style.backgroundColor="transparent";var f=a.background_image_url.value;switch(selectedSizeWidget.style.backgroundImage=f&&"none"!=f?"url("+f+")":"none",a.background_repeat.selectedIndex){case 1:selectedSizeWidget.style.backgroundRepeat="no-repeat";break;case 2:selectedSizeWidget.style.backgroundRepeat="repeat-x";break;case 3:selectedSizeWidget.style.backgroundRepeat="repeat-y";break;default:selectedSizeWidget.style.backgroundRepeat="repeat"}selectedSizeWidget.style.backgroundPosition=a.background_x.value+" "+a.background_y.value;for(var g=selectedSizeWidget.firstChild;g;){if("DIV"==g.nodeName&&("widgetBorder"==g.className||"widgetBoxBorder"==g.className)){for(var h=g.firstChild;h;){if("DIV"==h.nodeName){h.style.padding="";var i=_getSize(a.padding_left.value);i?(h.style.paddingLeft=i,selectedSizeWidget.setAttribute("widget_padding_left",i)):(h.style.paddingLeft="",selectedSizeWidget.setAttribute("widget_padding_left",""));var j=_getSize(a.padding_right.value);j?(h.style.paddingRight=j,selectedSizeWidget.setAttribute("widget_padding_right",j)):(h.style.paddingRight="",selectedSizeWidget.setAttribute("widget_padding_right",""));var k=_getSize(a.padding_top.value);k?(h.style.paddingTop=k,selectedSizeWidget.setAttribute("widget_padding_top",k)):(h.style.paddingTop="",selectedSizeWidget.setAttribute("widget_padding_top",""));var l=_getSize(a.padding_bottom.value);l?(h.style.paddingBottom=l,selectedSizeWidget.setAttribute("widget_padding_bottom",l)):(h.style.paddingBottom="",selectedSizeWidget.setAttribute("widget_padding_bottom",""));break}h=h.nextSibling}break}g=g.nextSibling}selectedWidget=selectedSizeWidget,selectedSizeWidget=null;for(var m=selectedWidget.getAttribute("widget"),n=[],e=0;e<selectedWidget.attributes.length;e++)if(selectedWidget.attributes[e].nodeName&&selectedWidget.attributes[e].nodeValue){var o=selectedWidget.attributes[e].nodeName.toLowerCase();if("contenteditable"!=o&&"id"!=o&&"src"!=o&&"widget"!=o&&"body"!=o&&"class"!=o&&"widget_width"!=o&&"widget_width_type"!=o&&"xdpx"!=o&&"xdpy"!=o&&"height"!=o){var p=selectedWidget.attributes[e].nodeValue;p&&"Array"!=p&&(n[o]=p)}}n.style=getStyle(selectedWidget),n.selected_widget=m,n.module_srl=get_by_id("pageFo").module_srl.value,exec_xml("widget","procWidgetGenerateCodeInPage",n,function(a){doAddWidgetCode(a.widget_code)},new Array("error","message","widget_code","tpl","css_header"))}doHideWidgetSizeSetup()}function restoreWidgetButtons(){var a=get_by_id("widgetButton"),b=get_by_id("widgetBoxButton");if(a&&b){a.style.visibility="hidden",get_by_id("zonePageContent").parentNode.appendChild(a),b.style.visibility="hidden",get_by_id("zonePageContent").parentNode.appendChild(b);for(var c=0;c<hideElements.length;c++){hideElements[0].style.paddingTop=0}hideElements=[]}}function showWidgetButton(a,b){var c=get_by_id(a);c&&(c.style.visibility="visible",b.insertBefore(c,b.firstChild))}function widgetSetup(a){var b=new xEvent(a),c=b.target;if(!(jQuery(c).is(".widgetButtons")||jQuery(c).parents(".widgetButtons").size()>0||jQuery(c).is(".buttonBox")||jQuery(c).parents(".buttonBox").size()>0)){var d=jQuery(c).parents(".widgetOutput");if(0==d.size())return void restoreWidgetButtons();c=d.get(0);var e=d.attr("widget");if(e)if("widgetBox"==e)restoreWidgetButtons(),showWidgetButton("widgetBoxButton",c);else{restoreWidgetButtons(),showWidgetButton("widgetButton",c);var f=c.parentNode;if(f)for(;f;){if("DIV"==f.nodeName&&"widgetBox"==f.getAttribute("widget")){showWidgetButton("widgetBoxButton",f);break}f=f.parentNode}}}}function widgetCreateTmpObject(a){var b=a.getAttribute("id");return tmpObj=xCreateElement("DIV"),tmpObj.id=b+"_tmp",tmpObj.className=a.className,tmpObj.style.overflow="hidden",tmpObj.style.margin="0px",tmpObj.style.padding="0px",tmpObj.style.width=a.style.width,tmpObj.style.display="none",tmpObj.style.position="absolute",tmpObj.style.opacity=1,tmpObj.style.filter="alpha(opacity=100)",xLeft(tmpObj,xPageX(a)),xTop(tmpObj,xPageY(a)),document.body.appendChild(tmpObj),widgetTmpObject[a.id]=tmpObj,tmpObj}function widgetGetTmpObject(a){a.id||(a.id="widget_"+idStep++);var b=widgetTmpObject[a.id];return b||(b=widgetCreateTmpObject(a)),b}function widgetDragEnable(a,b,c,d){a.draggable=!0,a.dragStart=b,a.drag=c,a.dragEnd=d,widgetDragManager.isDrag||(widgetDragManager.isDrag=!0,xAddEventListener(document,"mousemove",widgetDragMouseMove,!1))}function widgetDragStart(a,b,c){if("widgetResize"!=a.className&&"widgetResizeLeft"!=a.className&&"widgetBoxResize"!=a.className&&"widgetBoxResizeLeft"!=a.className){var d=widgetGetTmpObject(a);xInnerHtml(d,xInnerHtml(a)),xLeft(d,xPageX(a)),xTop(d,xPageY(a)),xWidth(d,xWidth(a)),xHeight(d,xHeight(a)),xDisplay(d,"block")}}function widgetDrag(a,b,c){var d=40,e=10,f=xPageX(a.parentNode),g=xPageY(a.parentNode),h=a.xDPX,i=a.xDPY,j=xWidth(zonePageObj),k=xPageX(zonePageObj),l=k+j,m=xWidth(a.parentNode),n=getFloat(a.parentNode);if(n||(n="left"),"widgetResize"==a.className||"widgetBoxResize"==a.className){h<f+d&&(h=f+d),h>l&&(h=l),"right"==n&&(h=f+m);var o=h-f;o<d&&(o=d);var p=i-g;p<e&&(p=e),l<f+o&&(o=l-f),xWidth(a.nextSibling.nextSibling,o),xHeight(a.nextSibling.nextSibling,p),xWidth(a.parentNode,o),xHeight(a.parentNode,p)}else if("widgetResizeLeft"==a.className||"widgetBoxResizeLeft"==a.className){h<k&&(h=k),"left"==n&&(h=f);var o=m+(f-h);o<d&&(o=d);var p=i-g;p<e&&(p=e),xWidth(a.nextSibling,o),xHeight(a.nextSibling,p),xWidth(a.parentNode,o),xHeight(a.parentNode,p)}else{var q=widgetGetTmpObject(a);if(xLeft(q,parseInt(xPageX(q),10)+parseInt(b,10)),xTop(q,parseInt(xPageY(q),10)+parseInt(c,10)),a.parentNode!=zonePageObj){for(var r=xGetElementsByClassName("widgetOutput",a.parentNode),s=0;s<r.length;s++){var t=r[s],u=xPageX(t),v=xPageY(t),w=parseInt(u,10)+parseInt(xWidth(t),10),x=parseInt(v,10)+parseInt(xHeight(t),10);if(a!=t&&a.xDPX>=u&&a.xDPX<=w&&a.xDPY>=v&&a.xDPY<=x&&a.parentNode==t.parentNode){var y=t.nextSibling;y||(y=xCreateElement("DIV"),t.parentNode.appendChild(y));var z=a.nextSibling;return z||(z=xCreateElement("DIV"),a.parentNode.appendChild(z)),y&&y.parentNode.insertBefore(a,y),z&&z.parentNode.insertBefore(t,z),doFitBorderSize(),void(r=null)}}r=null;var A=jQuery(a).parents("div.nullWidget").get(0),u=xPageX(A),v=xPageY(A),w=parseInt(u,10)+parseInt(xWidth(A),10),x=parseInt(v,10)+parseInt(xHeight(A),10);if(a.xDPX<u||a.xDPX>w||a.xDPY<v||a.xDPY>x)return zonePageObj.insertBefore(a,jQuery(a).parents("div.widgetOutput[widget=widgetBox]").get(0)),void doFitBorderSize()}else{if("widgetBox"!=a.getAttribute("widget")){for(var B=xGetElementsByClassName("nullWidget",zonePageObj),s=0;s<B.length;s++){var t=B[s];xHeight(t,xHeight(t.parentNode)),xWidth(t,xWidth(t.parentNode));var u=xPageX(t),v=xPageY(t),w=parseInt(u,10)+parseInt(xWidth(t),10),x=parseInt(v,10)+parseInt(xHeight(t),10);if(a.xDPX>=u&&a.xDPX<=w&&a.xDPY>=v&&a.xDPY<=x&&"nullWidget"==t.className){var C=jQuery("div.widget_inner",jQuery(t));return 0==C.size()?t.appendChild(a):C.get(0).appendChild(a),widgetManualEnd(),doFitBorderSize(),void(B=null)}}B=null}for(var r=xGetElementsByClassName("widgetOutput",zonePageObj),s=0;s<r.length;s++){var t=r[s],D=t.getAttribute("widget");if("widgetBox"!=D&&t.parentNode==zonePageObj){var u=xPageX(t),v=xPageY(t),w=parseInt(u,10)+parseInt(xWidth(t),10),x=parseInt(v,10)+parseInt(xHeight(t),10);if(a!=t&&a.xDPX>=u&&a.xDPX<=w&&a.xDPY>=v&&a.xDPY<=x&&a.parentNode==t.parentNode){var y=t.nextSibling;y||(y=t.parentNode.lastChild),y||(y=xCreateElement("DIV"),t.parentNode.appendChild(y));var z=a.nextSibling;return z||(z=xCreateElement("DIV"),a.parentNode.appendChild(z)),y&&y.parentNode.insertBefore(a,y),z&&z.parentNode.insertBefore(t,z),doFitBorderSize(),void(r=null)}}}r=null}}}function widgetDragEnd(a,b,c){var d=widgetGetTmpObject(a);widgetDisapear=widgetDisapearObject(d,a),widgetDragDisable(a.getAttribute("id"))}function widgetDisapearObject(a,b){xInnerHtml(b,xInnerHtml(a)),xInnerHtml(a,""),xDisplay(a,"none"),a.parentNode.removeChild(a),widgetTmpObject[b.id]=null}function widgetMouseDown(a){for(var b=new xEvent(a),c=b.target;c&&!c.draggable;)c=xParent(c,!0);c&&(xPreventDefault(a),c.xDPX=b.pageX,c.xDPY=b.pageY,widgetDragManager.obj=c,xAddEventListener(document,"mouseup",widgetMouseUp,!1),c.dragStart&&c.dragStart(c,b.pageX,b.pageY))}function widgetMouseUp(a){if(widgetDragManager.obj){if(xPreventDefault(a),xRemoveEventListener(document,"mouseup",widgetMouseUp,!1),widgetDragManager.obj.dragEnd){var b=new xEvent(a);widgetDragManager.obj.dragEnd(widgetDragManager.obj,b.pageX,b.pageY)}widgetDragManager.obj=null,widgetDragManager.isDrag=!1}}function widgetDragMouseMove(a){var b=new xEvent(a);if(widgetDragManager.obj){xPreventDefault(a);var c=widgetDragManager.obj,d=b.pageX-c.xDPX,e=b.pageY-c.xDPY;c.xDPX=b.pageX,c.xDPY=b.pageY,c.drag?c.drag(c,d,e):xMoveTo(c,xLeft(c)+d,xTop(c)+e)}}function widgetDragDisable(a){if(widgetDragManager){var b=get_by_id(a);b.draggable=!1,b.dragStart=null,b.drag=null,b.dragEnd=null,xRemoveEventListener(b,"mousedown",widgetMouseDown,!1)}}function widgetManualEnd(){var a=widgetDragManager.obj;if(a){xRemoveEventListener(document,"mouseup",widgetMouseUp,!1),xAddEventListener(document,"mousemove",widgetDragMouseMove,!1);var b=widgetGetTmpObject(a);widgetDisapear=widgetDisapearObject(b,a),widgetDragDisable(a.getAttribute("id")),widgetDragManager.obj=null,widgetDragManager.isDrag=!1}}var zonePageObj=null,zoneModuleSrl=0,selectedWidget=null,writedText=null,checkDocumentWrite=!1;window.document.write=window.document.writeln=function(a){if(checkDocumentWrite)return void(writedText=a);if(!a.match(/^<\//)){window.opera||(a=a.replace(/&(?![#a-z0-9]+;)/g,"&")),a=a.replace(/(<[a-z]+)/g,"$1 xmlns='http://www.w3.org/1999/xhtml'");var b,c=jQuery("<div>").html(a)[0];b=document.getElementsByTagName("*"),b=b[b.length-1];for(var d=c.childNodes;d.length;)b.parentNode.appendChild(d[0])}};var selectedSizeWidget=null,hideElements=[],widgetDragManager={obj:null,isDrag:!1},widgetTmpObject=[],widgetDisappear=0,idStep=0;