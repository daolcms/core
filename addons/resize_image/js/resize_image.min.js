!function(a){function b(){var b,c,e,f,g,h=a(document.body);return d?(b=a("#xe_gallery_controls"),c=a("#xe_gallery_holder"),e=a("#xe_gallery_closebtn"),f=a("#xe_gallery_prevbtn"),g=a("#xe_gallery_nextbtn")):(d=a("<div>").attr("id","xe_gallery_screen").css({position:"absolute",display:"none",backgroundColor:"black",zIndex:500,opacity:.5}),b=a("<div>").attr("id","xe_gallery_controls").css({position:"absolute",display:"none",overflow:"hidden",zIndex:510}),e=a("<img>").attr("id","xe_gallery_closebtn").attr("src",request_uri+"addons/resize_image/iconClose.png").css({top:"10px"}).click(function(){d.xeHide()}).appendTo(b),f=a("<img>").attr("id","xe_gallery_prevbtn").attr("src",request_uri+"addons/resize_image/iconLeft.png").css("left","10px").click(function(){d.xePrev()}).appendTo(b),g=a("<img>").attr("id","xe_gallery_nextbtn").attr("src",request_uri+"addons/resize_image/iconRight.png").css("right","10px").click(function(){d.xeNext()}).appendTo(b),b.find("img").attr({width:60,height:60,className:"iePngFix"}).css({position:"absolute",width:"60px",height:"60px",zIndex:530,cursor:"pointer"}),c=a(new Image),c.attr("id","xe_gallery_holder").css("border","7px solid white").css("zIndex",520).appendTo(b).draggable(),h.append(d).append(b),c.live("load",function(){var b=a(window).width(),d=a(window).height();c.css({left:b/2-c.width()/2+"px",top:d/2-c.height()/2+"px"})}),d.xeShow=function(){var b=a(window).width(),c=a(window).height();a("#xe_gallery_controls,#xe_gallery_screen").css({display:"block",width:a(document).width()+"px",height:a(document).height()+"px",left:0,top:0}),e.css("left",Math.round((b-60)/2)+"px"),a("#xe_gallery_prevbtn,#xe_gallery_nextbtn").css("top",Math.round((c-60)/2)+"px"),this.xeMove(0)},d.xeHide=function(a){d.css("display","none"),b.css("display","none")},d.xePrev=function(){this.xeMove(-1)},d.xeNext=function(){this.xeMove(1)},d.xeMove=function(b){var d=a(window).width(),h=a(window).height();this.index+=b,f.css("visibility",this.index>0?"visible":"hidden"),g.css("visibility",this.index<this.list.size()-1?"visible":"hidden");var i=this.list.eq(this.index).attr("rawsrc");i||(i=this.list.eq(this.index).attr("src")),c.attr("src",i).removeAttr("width").removeAttr("height"),c.width()>0&&c.css({left:d/2-c.width()/2+"px",top:h/2-c.height()/2+"px"}),e.css({left:Math.round(Math.max(parseInt(a(document).scrollLeft())+(d-e.width())/2,0))+"px",top:Math.round(Math.max(parseInt(a(document).scrollTop())+10,0))+"px"})},a(document).keydown(d.xeHide)),d}function c(c){var d=a(this).closest(".xe_content"),e=d.find("img[rel=xe_gallery]"),f=a.inArray(a(this).get(0),e.get()),g=b();g.list=e,g.index=f,g.xeShow()}var d=null;a(function(){function b(a,c){if(c||(c=0),!(c>=10)){var d=this,e={width:d.width(),height:d.height()};if(!e.width||!e.height)return void setTimeout(function(){b.call(d,a,++c)},200);if(!(e.width<=a)){var f=a/e.width;d.removeAttr("width").removeAttr("height").css({width:a,height:parseInt(e.height*f,10)})}}}var d=/(?:(modules|addons|classes|common|layouts|libs|widgets|widgetstyles)\/)/i,e=/(?:common\/tpl\/images\/blank\.gif$)/i,f=a('<div style="height:1; overflow:hidden; opacity:0; display:block; clear:both;"></div>');a("div.xe_content").each(function(){var g=f.appendTo(this).width();f.remove(),g&&(a("img",this).each(function(){var c=a(this),f=c.attr("src");d.test(f)&&!e.test(f)||(c.attr("rel","xe_gallery"),b.call(c,g))}),a("img[rel=xe_gallery]",this).live("mouseover",function(){var b=a(this);b.parent("a").length||b.attr("onclick")||b.css("cursor","pointer").click(c)}))})})}(jQuery);