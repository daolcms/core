/**
 * @brief 화면내에서 상위 영역보다 이미지가 크면 리사이즈를 하고 클릭시 원본을 보여줄수 있도록 변경
 **/
(function(e){function n(){var n=e(document.body);var r,i,s,o,u;if(!t){t=e("<div>").attr("id","xe_gallery_screen").css({position:"absolute",display:"none",backgroundColor:"black",zIndex:500,opacity:.5});r=e("<div>").attr("id","xe_gallery_controls").css({position:"absolute",display:"none",overflow:"hidden",zIndex:510});s=e("<img>").attr("id","xe_gallery_closebtn").attr("src",request_uri+"addons/resize_image/iconClose.png").css({top:"10px"}).click(function(){t.xeHide()}).appendTo(r);o=e("<img>").attr("id","xe_gallery_prevbtn").attr("src",request_uri+"addons/resize_image/iconLeft.png").css("left","10px").click(function(){t.xePrev()}).appendTo(r);u=e("<img>").attr("id","xe_gallery_nextbtn").attr("src",request_uri+"addons/resize_image/iconRight.png").css("right","10px").click(function(){t.xeNext()}).appendTo(r);r.find("img").attr({width:60,height:60,className:"iePngFix"}).css({position:"absolute",width:"60px",height:"60px",zIndex:530,cursor:"pointer"});i=e(new Image);i.attr("id","xe_gallery_holder").css("border","7px solid white").css("zIndex",520).appendTo(r).draggable();n.append(t).append(r);i.live("load",function(){var t=e(window).width();var n=e(window).height();i.css({left:t/2-i.width()/2+"px",top:n/2-i.height()/2+"px"})});t.xeShow=function(){var t=e(window).width();var n=e(window).height();e("#xe_gallery_controls,#xe_gallery_screen").css({display:"block",width:e(document).width()+"px",height:e(document).height()+"px",left:0,top:0});s.css("left",Math.round((t-60)/2)+"px");e("#xe_gallery_prevbtn,#xe_gallery_nextbtn").css("top",Math.round((n-60)/2)+"px");this.xeMove(0)};t.xeHide=function(e){t.css("display","none");r.css("display","none")};t.xePrev=function(){this.xeMove(-1)};t.xeNext=function(){this.xeMove(1)};t.xeMove=function(t){var n=e(window).width();var r=e(window).height();this.index+=t;o.css("visibility",this.index>0?"visible":"hidden");u.css("visibility",this.index<this.list.size()-1?"visible":"hidden");var a=this.list.eq(this.index).attr("rawsrc");if(!a)a=this.list.eq(this.index).attr("src");i.attr("src",a).removeAttr("width").removeAttr("height");if(i.width()>0){i.css({left:n/2-i.width()/2+"px",top:r/2-i.height()/2+"px"})}s.css({left:Math.round(Math.max(parseInt(e(document).scrollLeft())+(n-s.width())/2,0))+"px",top:Math.round(Math.max(parseInt(e(document).scrollTop())+10,0))+"px"})};e(document).keydown(t.xeHide)}else{r=e("#xe_gallery_controls");i=e("#xe_gallery_holder");s=e("#xe_gallery_closebtn");o=e("#xe_gallery_prevbtn");u=e("#xe_gallery_nextbtn")}return t}function r(t){var r=e(this).closest(".xe_content");var i=r.find("img[rel=xe_gallery]");var s=e.inArray(e(this).get(0),i.get());var o=n();o.list=i;o.index=s;o.xeShow()}var t=null;e(function(){function s(e,t){if(!t)t=0;if(t>=10)return;var n=this;var r={width:n.width(),height:n.height()};if(!r.width||!r.height){setTimeout(function(){s.call(n,e,++t)},200);return}if(r.width<=e)return;var i=e/r.width;n.removeAttr("width").removeAttr("height").css({width:e,height:parseInt(r.height*i,10)})}var t=/(?:(modules|addons|classes|common|layouts|libs|widgets|widgetstyles)\/)/i;var n=/(?:common\/tpl\/images\/blank\.gif$)/i;var i=e('<div style="height:1; overflow:hidden; opacity:0; display:block; clear:both;"></div>');e("div.xe_content").each(function(){var o=i.appendTo(this).width();i.remove();if(!o)return;e("img",this).each(function(){var r=e(this);var i=r.attr("src");if(t.test(i)&&!n.test(i))return;r.attr("rel","xe_gallery");s.call(r,o)});e("img[rel=xe_gallery]",this).live("mouseover",function(){var t=e(this);if(!t.parent("a").length&&!t.attr("onclick")){t.css("cursor","pointer").click(r)}})})})})(jQuery)